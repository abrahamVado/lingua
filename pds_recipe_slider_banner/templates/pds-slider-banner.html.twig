{#
  Variables:
  - items: array of rows saved in block config
  - group_id: numeric identifier of the master record
  - instance_uuid: UUID used as the stable key for API access
  - master_metadata: associative array with group_id, instance_uuid, recipe_type, items_count
  - extended_datasets: derivative datasets built for public consumers
#}

{# //1.- Normalize the stored rows so the slider only iterates arrays. #}
{% set slide_items = items is iterable ? items : [] %}

<section
  class="principal_hero principal_hero--gradient-dark"
  data-pds-slider-banner-root="1"
  {% if master_metadata.group_id is defined and master_metadata.group_id != 0 %}
    data-pds-slider-banner-master-id="{{ master_metadata.group_id }}"
  {% endif %}
  {% if master_metadata.instance_uuid is defined and master_metadata.instance_uuid %}
    data-pds-slider-banner-master-uuid="{{ master_metadata.instance_uuid|e }}"
  {% endif %}
  {% if master_metadata.recipe_type is defined and master_metadata.recipe_type %}
    data-pds-slider-banner-recipe-type="{{ master_metadata.recipe_type|e }}"
  {% endif %}
  {% if master_metadata.items_count is defined %}
    data-pds-slider-banner-items-count="{{ master_metadata.items_count }}"
  {% endif %}
  data-pds-slider-banner-autoplay="6000"
  data-pds-slider-banner-speed="500"
>
  {% if slide_items|length > 0 %}
    <div class="principal_hero__slider" data-pds-slider-banner-track>
      {% for row in slide_items %}
        {# //2.- Resolve responsive media sources for desktop and mobile contexts. #}
        {% set desktop_image = row.desktop_img ?? row.image_url ?? '' %}
        {% set mobile_image = row.mobile_img ?? desktop_image %}
        {% set slide_alt = row.image_alt is defined and row.image_alt ? row.image_alt : row.header %}
        <article class="principal_hero__slide" data-pds-slider-banner-slide>
          <picture class="principal_hero__bg">
            {% if desktop_image %}
              <source media="(min-width: 768px)" srcset="{{ desktop_image|e }}">
            {% endif %}
            {% if mobile_image %}
              <img
                class="principal_hero__bgImg"
                src="{{ mobile_image|e }}"
                alt="{{ slide_alt|default('')|e }}"
              />
            {% else %}
              <span class="principal_hero__bgImg principal_hero__bgImg--empty" aria-hidden="true"></span>
            {% endif %}
          </picture>

          <div class="principal_hero__inner">
            <div class="principal_hero__content">
              {% if row.header %}
                {# //3.- Render the main headline allowing inline emphasis markup. #}
                <h1 class="principal_hero__title">
                  {{ row.header|raw }}
                </h1>
              {% endif %}
              {% if row.subheader %}
                {# //4.- Surface optional supporting text directly below the title. #}
                <p class="principal_hero__subtitle">{{ row.subheader|raw }}</p>
              {% endif %}
              {% if row.description %}
                {# //5.- Provide the descriptive copy for the slide body. #}
                <p class="principal_hero__intro">{{ row.description|raw }}</p>
              {% endif %}
              {% if row.link %}
                {# //6.- Print the call-to-action button when a destination URL exists. #}
                {% set link_label = row.link_label ?? row.link_text ?? 'Ver m√°s' %}
                <div class="principal_hero__cta">
                  <a
                    class="principal_btn principal_btn--primary"
                    href="{{ row.link|e }}"
                  >
                    {{ link_label|e }}
                  </a>
                </div>
              {% endif %}
            </div>
          </div>
        </article>
      {% endfor %}
    </div>

    <button
      class="principal_hero__arrow principal_hero__arrow--prev"
      type="button"
      aria-label="Anterior"
      data-pds-slider-banner-prev
    ></button>
    <button
      class="principal_hero__arrow principal_hero__arrow--next"
      type="button"
      aria-label="Siguiente"
      data-pds-slider-banner-next
    ></button>

    <div class="principal_hero__dots" data-pds-slider-banner-dots></div>
  {% else %}
    <div class="principal_hero__empty" role="status">No rows available.</div>
  {% endif %}
</section>
