{#
  Variables:
  - items: array of rows saved in block config
  - group_id: numeric identifier of the master record
  - instance_uuid: UUID used as the stable key for API access
  - master_metadata: associative array with group_id, instance_uuid, recipe_type, items_count
  - extended_datasets: derivative datasets built for public consumers
  - timeline_meta: associative array with heading and years extracted from milestones JSON
#}

{% set timeline_heading = timeline_meta.heading|default('Principais executivos') %}
{% set timeline_years = timeline_meta.years is defined and timeline_meta.years is iterable ? timeline_meta.years : [] %}

<section
  id="principal-timeline"
  class="principal-timeline"
  {% if master_metadata.group_id is defined and master_metadata.group_id != 0 %}
    data-pds-timeline-master-id="{{ master_metadata.group_id }}"
  {% endif %}
  {% if master_metadata.instance_uuid is defined and master_metadata.instance_uuid %}
    data-pds-timeline-master-uuid="{{ master_metadata.instance_uuid|e }}"
  {% endif %}
  {% if master_metadata.recipe_type is defined and master_metadata.recipe_type %}
    data-pds-timeline-recipe-type="{{ master_metadata.recipe_type|e }}"
  {% endif %}
  {% if master_metadata.items_count is defined %}
    data-pds-timeline-items-count="{{ master_metadata.items_count }}"
  {% endif %}
>
  <div class="principal-timeline__container">
    <h2 class="principal-timeline__title">{{ timeline_heading|e }}</h2>
    {% if items is iterable and items|length > 0 %}
      <div class="principal-timeline__viewport">
        <div class="principal-timeline__track">
          {% if timeline_years|length > 0 %}
            <div class="principal-timeline__years" aria-hidden="true">
              {% for year in timeline_years %}
                <span class="principal-timeline__year">{{ year|e }}</span>
              {% endfor %}
            </div>
          {% endif %}

          {% for row in items %}
            <div class="principal-timeline__row">
              <div class="principal-timeline__person">
                <span class="principal-timeline__person-name">{{ row.header|default('')|e }}</span>
                {% if row.subheader is defined and row.subheader %}
                  <span class="principal-timeline__person-role">{{ row.subheader|e }}</span>
                {% endif %}
              </div>
              <div class="principal-timeline__jobs">
                {% set segments = row.timeline_segments is defined and row.timeline_segments is iterable ? row.timeline_segments : [] %}
                {% if segments|length > 0 %}
                  {% for segment in segments %}
                    {% set classes = ['principal-timeline__job-segment'] %}
                    {% if segment.is_principal %}
                      {% set classes = classes|merge(['principal-timeline__job-segment--principal']) %}
                    {% endif %}
                    {% if segment.is_first %}
                      {% set classes = classes|merge(['principal-timeline__job-segment--first']) %}
                    {% endif %}
                    {% if segment.classes is defined and segment.classes is iterable %}
                      {% for extra_class in segment.classes %}
                        {% if extra_class %}
                          {% set classes = classes|merge([extra_class]) %}
                        {% endif %}
                      {% endfor %}
                    {% endif %}
                    <div class="{{ classes|join(' ') }}" style="width:{{ segment.width_style|default('0%') }}">
                      {% set info_classes = ['principal-timeline__job-info'] %}
                      {% if segment.tooltip_variant is defined and segment.tooltip_variant == 'principal' %}
                        {% set info_classes = info_classes|merge(['principal-timeline__job-info--principal']) %}
                      {% elseif segment.tooltip_variant is defined and segment.tooltip_variant == 'default' %}
                        {% set info_classes = info_classes|merge(['principal-timeline__job-info--default']) %}
                      {% endif %}
                      <span class="{{ info_classes|join(' ') }}">
                        {{ segment.info_text|default('')|e }}
                        {% if segment.info_image %}
                          <img src="{{ segment.info_image|e }}" alt="{{ segment.info_image_alt|default(row.header)|e }}">
                        {% endif %}
                      </span>
                      <div class="principal-timeline__job-segment-line"></div>
                    </div>
                  {% endfor %}
                {% else %}
                  <div class="principal-timeline__job-segment principal-timeline__job-segment--first" style="width:100%">
                    <span class="principal-timeline__job-info"></span>
                    <div class="principal-timeline__job-segment-line"></div>
                  </div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
        <div class="principal-timeline__tooltip" id="principalTimelineTooltip" role="tooltip" hidden></div>
      </div>
    {% else %}
      <div class="principal-timeline__empty">{{ 'No timeline entries available.'|t }}</div>
    {% endif %}
  </div>
</section>
