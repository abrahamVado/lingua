{#
  Variables:
  - items: array of rows saved in block config
  - group_id: numeric identifier of the master record
  - instance_uuid: UUID used as the stable key for API access
  - master_metadata: associative array with group_id, instance_uuid, recipe_type, items_count
  - extended_datasets: derivative datasets built for public consumers
#}

{% set component_config = config('pds_recipe_timeline.settings') %}
{% set heading = component_config.get('header')|default('') %}
{% set heading_accent = component_config.get('header_accent')|default('') %}

<section
  id="principal-timeline"
  class="principal-timeline"
  {% if master_metadata.group_id is defined and master_metadata.group_id != 0 %}
    data-pds-timeline-master-id="{{ master_metadata.group_id }}"
  {% endif %}
  {% if master_metadata.instance_uuid is defined and master_metadata.instance_uuid %}
    data-pds-timeline-master-uuid="{{ master_metadata.instance_uuid|e }}"
  {% endif %}
  {% if master_metadata.recipe_type is defined and master_metadata.recipe_type %}
    data-pds-timeline-recipe-type="{{ master_metadata.recipe_type|e }}"
  {% endif %}
  {% if master_metadata.items_count is defined %}
    data-pds-timeline-items-count="{{ master_metadata.items_count }}"
  {% endif %}
>
  <div class="principal-timeline__container">
    {% if heading or heading_accent %}
      <h2 class="principal-timeline__title">
        {{ heading|e }}
        {% if heading_accent %}
          <span>{{ heading_accent|e }}</span>
        {% endif %}
      </h2>
    {% endif %}

    <div class="principal-timeline__viewport">
      <div class="principal-timeline__track">
        <div class="principal-timeline__years" aria-hidden="true">
          <span class="principal-timeline__year">91</span>
          <span class="principal-timeline__year">92</span>
          <span class="principal-timeline__year">93</span>
          <span class="principal-timeline__year">94</span>
          <span class="principal-timeline__year">95</span>
          <span class="principal-timeline__year">96</span>
          <span class="principal-timeline__year">97</span>
          <span class="principal-timeline__year">98</span>
          <span class="principal-timeline__year">99</span>
          <span class="principal-timeline__year">00</span>
          <span class="principal-timeline__year">01</span>
          <span class="principal-timeline__year">02</span>
          <span class="principal-timeline__year">03</span>
          <span class="principal-timeline__year">04</span>
          <span class="principal-timeline__year">05</span>
          <span class="principal-timeline__year">06</span>
          <span class="principal-timeline__year">07</span>
          <span class="principal-timeline__year">08</span>
          <span class="principal-timeline__year">09</span>
          <span class="principal-timeline__year">10</span>
          <span class="principal-timeline__year">11</span>
          <span class="principal-timeline__year">12</span>
          <span class="principal-timeline__year">13</span>
          <span class="principal-timeline__year">14</span>
          <span class="principal-timeline__year">15</span>
          <span class="principal-timeline__year">16</span>
          <span class="principal-timeline__year">17</span>
          <span class="principal-timeline__year">18</span>
          <span class="principal-timeline__year">19</span>
          <span class="principal-timeline__year">20</span>
          <span class="principal-timeline__year">21</span>
          <span class="principal-timeline__year">22</span>
          <span class="principal-timeline__year">23</span>
          <span class="principal-timeline__year">24</span>
          <span class="principal-timeline__year">25</span>
        </div>

        {% if items is iterable and items|length > 0 %}
          {% for row in items %}
            {% set description_html = row.description|default('') %}
            <div class="principal-timeline__row">
              <div class="principal-timeline__person">
                {% if row.header %}
                  <span class="principal-timeline__person-name">{{ row.header|e }}</span>
                {% endif %}
                {% if row.subheader %}
                  <span class="principal-timeline__person-role">{{ row.subheader|e }}</span>
                {% endif %}
              </div>
              {% if 'principal-timeline__jobs' in description_html %}
                {{ description_html|raw }}
              {% else %}
                <div class="principal-timeline__jobs">
                  {% if description_html %}
                    {{ description_html|raw }}
                  {% else %}
                    <span class="principal-timeline__job-info principal-timeline__job-info--empty">{{ 'Sem experiÃªncias registradas.'|t }}</span>
                  {% endif %}
                </div>
              {% endif %}
            </div>
          {% endfor %}
        {% else %}
          <div class="principal-timeline__empty">{{ 'No rows available.'|t }}</div>
        {% endif %}
      </div>
      <div class="principal-timeline__tooltip" id="principalTimelineTooltip" role="tooltip" hidden></div>
    </div>
  </div>

  {% if extended_datasets.media is defined or extended_datasets.geo is defined %}
    <div class="principal-timeline__datasets" hidden>
      {% if extended_datasets.media is defined %}
        {% if extended_datasets.media.desktop is defined and extended_datasets.media.desktop|length > 0 %}
          <ul data-pds-timeline-media="desktop">
            {% for image in extended_datasets.media.desktop %}
              <li data-pds-timeline-media-index="{{ image.index }}">
                <span class="principal-timeline__media-label">{{ image.label|default('')|e }}</span>
                <span class="principal-timeline__media-url">{{ image.url|e }}</span>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
        {% if extended_datasets.media.mobile is defined and extended_datasets.media.mobile|length > 0 %}
          <ul data-pds-timeline-media="mobile">
            {% for image in extended_datasets.media.mobile %}
              <li data-pds-timeline-media-index="{{ image.index }}">
                <span class="principal-timeline__media-label">{{ image.label|default('')|e }}</span>
                <span class="principal-timeline__media-url">{{ image.url|e }}</span>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endif %}

      {% if extended_datasets.geo is defined and extended_datasets.geo|length > 0 %}
        <ul data-pds-timeline-geo="1">
          {% for point in extended_datasets.geo %}
            <li data-pds-timeline-media-index="{{ point.index }}">
              <span class="principal-timeline__geo-label">{{ point.label|default('')|e }}</span>
              <span class="principal-timeline__geo-lat">{{ point.latitude }}</span>
              <span class="principal-timeline__geo-lng">{{ point.longitude }}</span>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  {% endif %}
</section>
