<?php

/**
 * @file
 * pds_recipe_mapa.module
 *
 * Module-level hooks. No form submit or AJAX handlers live here anymore.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_theme().
 */
function pds_recipe_mapa_theme($existing, $type, $theme, $path) {
  return [
    'pds_mapa' => [
      'template' => 'pds-mapa',
      'path' => $path . '/templates',
      'variables' => [
        'mapa_src' => '',
        'mapa_alt' => 'Mapa mundial',
        'pins'     => [],
      ],
    ],
  ];
}

/**
 * Preprocess for theme hook pds_mapa.
 *
 * Runs for frontend render of the block (not the admin form).
 * Attaches the public map CSS/JS and normalizes vars.
 */
function pds_recipe_mapa_preprocess_pds_mapa(array &$vars): void {
  // Attach the public-facing library (tooltip behavior etc).
  // Must exist in pds_recipe_mapa.libraries.yml:
  //
  // principal_mapa:
  //   css:
  //     theme:
  //       css/principal_mapa.css: {}
  //   js:
  //     js/principal_mapa.js: {}
  //   dependencies:
  //     - core/drupal
  //
  $vars['#attached']['library'][] = 'pds_recipe_mapa/principal_mapa';

  // Normalize data passed from the block build().
  $vars['mapa_src'] = $vars['mapa_src'] ?? '';
  $vars['mapa_alt'] = $vars['mapa_alt'] ?? 'Mapa mundial';
  $vars['pins']     = array_values($vars['pins'] ?? []);
}
