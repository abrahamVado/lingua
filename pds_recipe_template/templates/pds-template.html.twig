{#
  Variables:
  - items: array of rows saved in block config
  - group_id: numeric identifier of the master record
  - instance_uuid: UUID used as the stable key for API access
  - master_metadata: associative array with group_id, instance_uuid, recipe_type, items_count
  - extended_datasets: derivative datasets built for public consumers
#}

<div
  class="pds-template-display-wrapper"
  data-pds-template-master-id="{{ master_metadata.group_id|default(0) }}"
  {% if master_metadata.instance_uuid is defined and master_metadata.instance_uuid %}
    data-pds-template-master-uuid="{{ master_metadata.instance_uuid|e }}"
  {% endif %}
  {% if master_metadata.recipe_type is defined and master_metadata.recipe_type %}
    data-pds-template-recipe-type="{{ master_metadata.recipe_type|e }}"
  {% endif %}
  {% if master_metadata.items_count is defined %}
    data-pds-template-items-count="{{ master_metadata.items_count }}"
  {% endif %}
>
  {% if items is iterable and items|length > 0 %}
    <table class="pds-template-display-table">
      <thead>
        <tr>
          <th>Header</th>
          <th>Subheader</th>
          <th>Description</th>
          <th>Link</th>
          <th>Image</th>
        </tr>
      </thead>
      <tbody>
        {% for row in items %}
          <tr>
            <td>{{ row.header|e }}</td>
            <td>{{ row.subheader|e }}</td>
            <td>{{ row.description|e }}</td>
            <td>
              {% if row.link %}
                <a href="{{ row.link|e }}" rel="noopener noreferrer">{{ row.link|e }}</a>
              {% else %}
                —
              {% endif %}
            </td>
            <td>
              {% if row.image_url %}
                <img
                  src="{{ row.image_url|e }}"
                  alt="{{ row.header|e }}"
                  class="pds-template-display-thumb" />
              {% else %}
                —
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if extended_datasets.media is defined %}
      <div class="pds-template-display-media">
        {% if extended_datasets.media.desktop is defined and extended_datasets.media.desktop|length > 0 %}
          <ul class="pds-template-display-media__desktop" data-pds-template-media="desktop">
            {% for image in extended_datasets.media.desktop %}
              <li data-pds-template-media-index="{{ image.index }}">
                <span class="pds-template-display-media__label">{{ image.label|default('')|e }}</span>
                <span class="pds-template-display-media__url">{{ image.url|e }}</span>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
        {% if extended_datasets.media.mobile is defined and extended_datasets.media.mobile|length > 0 %}
          <ul class="pds-template-display-media__mobile" data-pds-template-media="mobile">
            {% for image in extended_datasets.media.mobile %}
              <li data-pds-template-media-index="{{ image.index }}">
                <span class="pds-template-display-media__label">{{ image.label|default('')|e }}</span>
                <span class="pds-template-display-media__url">{{ image.url|e }}</span>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    {% endif %}
    {% if extended_datasets.geo is defined and extended_datasets.geo|length > 0 %}
      <div class="pds-template-display-geo" data-pds-template-geo="1">
        <ul class="pds-template-display-geo__list">
          {% for point in extended_datasets.geo %}
            <li data-pds-template-media-index="{{ point.index }}">
              <span class="pds-template-display-geo__label">{{ point.label|default('')|e }}</span>
              <span class="pds-template-display-geo__lat">{{ point.latitude }}</span>
              <span class="pds-template-display-geo__lng">{{ point.longitude }}</span>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  {% else %}
    <div>No rows available.</div>
  {% endif %}
</div>
