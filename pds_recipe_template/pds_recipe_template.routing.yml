# File: pds_recipe_template.routing.yml
# Notes:
# - Unsafe methods (POST/PATCH) require CSRF tokens via _csrf_token: 'TRUE'.
# - UUID regex is limited to exactly 36 chars of hex + dashes (UUID v4-style).
# - _format: json helps the Negotiate middleware & clients agree on JSON.

pds_recipe_template.ensure_group:
  path: '/pds-template/ensure-group/{uuid}'
  defaults:
    _controller: '\Drupal\pds_recipe_template\Controller\GroupController::ensureGroup'
    _title: 'Ensure PDS Template group'
    _format: 'json'
  requirements:
    # Prefer a custom capability over broad 'access content'.
    _permission: 'access content'
    # 36-char hex/dash UUID (e.g., 8-4-4-4-12). Routing regex does not need ^$.
    uuid: '[0-9a-fA-F-]{36}'
    _csrf_token: 'TRUE'   # POST must carry a CSRF token.
  methods: ['POST']

pds_recipe_template.resolve_row:
  path: '/pds-template/resolve-row/{uuid}'
  defaults:
    _controller: '\Drupal\pds_recipe_template\Plugin\Block\PdsTemplateBlock::ajaxResolveRow'
    _title: 'Resolve PDS Template row'
    _format: 'json'
  requirements:
    _permission: 'access content'
    uuid: '[0-9a-fA-F-]{36}'
    _csrf_token: 'TRUE'
  methods: ['POST']

pds_recipe_template.create_row:
  path: '/pds-template/create-row/{uuid}'
  defaults:
    _controller: '\Drupal\pds_recipe_template\Controller\RowController::createRow'
    _title: 'Create PDS Template row'
    _format: 'json'
  requirements:
    _permission: 'access content'
    uuid: '[0-9a-fA-F-]{36}'
    _csrf_token: 'TRUE'
  methods: ['POST']

pds_recipe_template.update_row:
  path: '/pds-template/update-row/{uuid}/{row_uuid}'
  defaults:
    _controller: '\Drupal\pds_recipe_template\Controller\RowController::update'
    _title: 'Update PDS Template row'
    _format: 'json'
  requirements:
    _permission: 'access content'
    uuid: '[0-9a-fA-F-]{36}'
    row_uuid: '[0-9a-fA-F-]{36}'
    _csrf_token: 'TRUE'
  # PATCH is ideal; POST kept for environments with limited verb support.
  methods: ['PATCH', 'POST']

pds_recipe_template.list_rows:
  path: '/pds-template/list-rows/{uuid}'
  defaults:
    _controller: '\Drupal\pds_recipe_template\Controller\RowController::list'
    _title: 'List PDS Template rows'
    _format: 'json'
  requirements:
    # Listing is still privileged because it reveals editor-previews.
    _permission: 'access content'
    uuid: '[0-9a-fA-F-]{36}'
  methods: ['GET']
